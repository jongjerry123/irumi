package com.project.irumi.board.controller;

import java.io.File;
import java.io.IOException;
import java.util.List;
import java.util.Map;
import java.util.UUID;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.MultipartFile;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.project.irumi.board.dto.CommentDTO;
import com.project.irumi.board.dto.PostDTO;
import com.project.irumi.board.service.PostService;
import com.project.irumi.dashboard.model.dto.Job;
import com.project.irumi.user.model.dto.User;

import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import jakarta.servlet.http.HttpSession;

@Controller
public class BoardController {

	@Autowired
	private PostService postService;

	// ÏûêÏú†Í≤åÏãúÌåê
	@GetMapping("/freeBoard.do")
	public String showFreeBoard(@RequestParam(value = "period", required = false, defaultValue = "Ï†ÑÏ≤¥") String period,
			@RequestParam(value = "sort", required = false, defaultValue = "") String sort,
			@RequestParam(value = "keyword", required = false, defaultValue = "") String keyword,
			@RequestParam(value = "page", required = false, defaultValue = "1") int page, Model model) {
		int pageSize = 10;
		int offset = (page - 1) * pageSize;
		List<PostDTO> posts = postService.getFilteredPosts("ÏùºÎ∞ò", period, sort, keyword, offset, pageSize);
		 // Ïç∏ÎÑ§Ïùº URL ÏÑ∏ÌåÖ
	    for (PostDTO post : posts) {
	    	if (post.getPostSavedName() == null || !isImageFile(post.getPostSavedName())) {
	            String thumbUrl = extractFirstImageUrl(post.getPostContent());
	            post.setFirstImageUrl(thumbUrl);
	        }
	    }
	    
		int totalCount = postService.countFilteredPosts("ÏùºÎ∞ò", period, keyword);
		int totalPages = (int) Math.ceil((double) totalCount / pageSize);

		model.addAttribute("postList", posts);
		model.addAttribute("selectedPeriod", period);
		model.addAttribute("selectedSort", sort);
		model.addAttribute("keyword", keyword);
		model.addAttribute("currentPage", page);
		model.addAttribute("totalCount", totalCount);
		model.addAttribute("totalPages", totalPages);

		return "board/boardListView";
	}

	// Í≥µÏßÄÏÇ¨Ìï≠
	@GetMapping("/noticeList.do")
	public String showNoticeList(@RequestParam(value = "page", required = false, defaultValue = "1") int page,
			Model model) {
		int pageSize = 10;
		int offset = (page - 1) * pageSize;

		List<PostDTO> notices = postService.getPostsByTypeWithPaging("Í≥µÏßÄ", offset, pageSize);
		int totalCount = postService.countPostsByType("Í≥µÏßÄ");
		int totalPages = (int) Math.ceil((double) totalCount / pageSize);

		model.addAttribute("postList", notices);
		model.addAttribute("currentPage", page);
		model.addAttribute("totalPages", totalPages);
		model.addAttribute("totalCount", totalCount);

		return "board/noticeList";
	}

	// QnA Î™©Î°ù
	@GetMapping("/qnaList.do")
	public String showQnaList(@RequestParam(value = "period", required = false, defaultValue = "Ï†ÑÏ≤¥") String period,
			@RequestParam(value = "sort", required = false, defaultValue = "") String sort,
			@RequestParam(value = "keyword", required = false, defaultValue = "") String keyword,
			@RequestParam(value = "page", required = false, defaultValue = "1") int page, Model model,
			HttpSession session) {
		int pageSize = 10;
		int offset = (page - 1) * pageSize;
		List<PostDTO> posts = postService.getFilteredPosts("ÏßàÎ¨∏", period, sort, keyword, offset, pageSize);

		for (PostDTO post : posts) {
			boolean hasAnswer = postService.hasAnswer(post.getPostId());
			post.setHasAnswer(hasAnswer);
		}

		int totalCount = postService.countFilteredPosts("ÏßàÎ¨∏", period, keyword);
		int totalPages = (int) Math.ceil((double) totalCount / pageSize);

		model.addAttribute("postList", posts);
		model.addAttribute("selectedPeriod", period);
		model.addAttribute("selectedSort", sort);
		model.addAttribute("keyword", keyword);
		model.addAttribute("currentPage", page);
		model.addAttribute("totalCount", totalCount);
		model.addAttribute("totalPages", totalPages);
		model.addAttribute("isMyQna", false);

		return "board/qnaList";
	}

	// ÎÇ¥ ÏßàÎ¨∏Îßå Î≥¥Í∏∞
	@GetMapping("/myQna.do")
	public String showMyQnaPosts(HttpSession session, Model model,
			@RequestParam(value = "page", required = false, defaultValue = "1") int page) {
		User loginUser = (User) session.getAttribute("loginUser");
		if (loginUser == null) {
			return "redirect:/loginPage.do";
		}

		int pageSize = 10;
		int offset = (page - 1) * pageSize;
		List<PostDTO> posts = postService.getMyQnaPosts(loginUser.getUserId(), offset, pageSize);
		int totalCount = postService.countMyQnaPosts(loginUser.getUserId());
		int totalPages = (int) Math.ceil((double) totalCount / pageSize);

		model.addAttribute("postList", posts);
		model.addAttribute("currentPage", page);
		model.addAttribute("totalPages", totalPages);
		model.addAttribute("isMyQna", true);

		return "board/qnaList";
	}

	// Í∏ÄÏì∞Í∏∞ ÌôîÎ©¥
	@GetMapping("/writePost.do")
	public String showWritePostForm(@RequestParam("type") String type, Model model) {
		model.addAttribute("postType", type);
		return "board/writePost";
	}

	// Í∏Ä Îì±Î°ù
	@PostMapping("/insertPost.do")
	public String insertPost(@ModelAttribute PostDTO post,
	                         @RequestParam("uploadFile") MultipartFile file,
	                         HttpSession session) throws IOException {
	    User loginUser = (User) session.getAttribute("loginUser");
	    if (loginUser == null) {
	        return "redirect:/loginPage.do";
	    }

	    post.setPostWriter(loginUser.getUserId());

	    if (!file.isEmpty()) {
	        String originalName = file.getOriginalFilename();
	        String savedName = UUID.randomUUID() + "_" + originalName;
	        String uploadDir = session.getServletContext().getRealPath("/resources/uploads/");
	        File saveFile = new File(uploadDir, savedName);

	        // ÏóÖÎ°úÎìú ÎîîÎ†âÌÜ†Î¶¨ ÏóÜÏúºÎ©¥ ÏÉùÏÑ±
	        if (!saveFile.getParentFile().exists()) {
	            saveFile.getParentFile().mkdirs();
	        }

	        file.transferTo(saveFile);

	        post.setPostOriginalName(originalName);
	        post.setPostSavedName(savedName);
	    }

	    postService.insertPost(post);

	    return switch (post.getPostType()) {
	        case "ÏßàÎ¨∏" -> "redirect:/qnaList.do";
	        case "Í≥µÏßÄ" -> "redirect:/noticeList.do";
	        default -> "redirect:/freeBoard.do";
	    };
	}

	// Í≤åÏãúÍ∏Ä ÏÉÅÏÑ∏Î≥¥Í∏∞
	@GetMapping("/postDetail.do")
	public String showPostDetail(@RequestParam("postId") Long postId, Model model) {
		postService.increasePostViewCount(postId);
		PostDTO post = postService.getPostById(postId);
		List<CommentDTO> commentList = postService.getCommentsByPostId(postId);

		model.addAttribute("post", post);
		model.addAttribute("commentList", commentList);
		return "board/postDetailView";
	}

	// Í≤åÏãúÍ∏Ä Ï∂îÏ≤ú (Ï§ëÎ≥µ Î∞©ÏßÄ)
	@PostMapping("/recommendPost.do")
	public String recommendPost(@RequestParam("postId") Long postId, HttpSession session, HttpServletResponse response)
			throws IOException {
		User loginUser = (User) session.getAttribute("loginUser");
		if (loginUser == null)
			return "redirect:/loginPage.do";

		String userId = loginUser.getUserId();
		if (postService.hasAlreadyRecommendedPost(userId, postId)) {
			response.setContentType("text/html; charset=UTF-8");
			response.getWriter().write("<script>alert('Ïù¥ÎØ∏ Ï∂îÏ≤úÌïòÏÖ®ÏäµÎãàÎã§.'); history.back();</script>");
			return null;
		}
		postService.recommendPost(postId, userId);
		return "redirect:/postDetail.do?postId=" + postId;
	}

	// Í≤åÏãúÍ∏Ä Ïã†Í≥† (Ï§ëÎ≥µ Î∞©ÏßÄ)
	@PostMapping("/reportPost.do")
	public String reportPost(@RequestParam("postId") Long postId, HttpSession session, HttpServletResponse response)
			throws IOException {
		User loginUser = (User) session.getAttribute("loginUser");
		if (loginUser == null)
			return "redirect:/loginPage.do";

		String userId = loginUser.getUserId();
		if (postService.hasAlreadyReportedPost(userId, postId)) {
			response.setContentType("text/html; charset=UTF-8");
			response.getWriter().write("<script>alert('Ïù¥ÎØ∏ Ïã†Í≥†ÌïòÏÖ®ÏäµÎãàÎã§.'); history.back();</script>");
			return null;
		}
		postService.reportPost(postId, userId);
		return "redirect:/postDetail.do?postId=" + postId;
	}

	// ÎåìÍ∏Ä Îì±Î°ù
	@PostMapping("/addComment.do")
	public String addComment(@RequestParam("postId") Long postId,
            @RequestParam("commentContent") String commentContent,
            @RequestParam(value = "parentId", required = false) Long parentId,
            HttpSession session,
            HttpServletResponse response) throws IOException {
		User loginUser = (User) session.getAttribute("loginUser");
		if (loginUser == null)
			return "redirect:/loginPage.do";
		// üîí Îπà ÎåìÍ∏Ä ÏûÖÎ†• Î∞©ÏßÄ
	    if (commentContent == null || commentContent.trim().isEmpty()) {
	        response.setContentType("text/html; charset=UTF-8");
	        response.getWriter().write("<script>alert('ÎåìÍ∏Ä ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); history.back();</script>");
	        return null;
	    }

		postService.addComment(postId, commentContent, loginUser.getUserId(), parentId);
		return "redirect:/postDetail.do?postId=" + postId;
	}

	// ÎåìÍ∏Ä Ï∂îÏ≤ú (Ï§ëÎ≥µ Î∞©ÏßÄ)
	@PostMapping("/recommendComment.do")
	public String recommendComment(@RequestParam("commentId") Long commentId, @RequestParam("postId") Long postId,
			HttpSession session, HttpServletResponse response) throws IOException {
		User loginUser = (User) session.getAttribute("loginUser");
		if (loginUser == null)
			return "redirect:/loginPage.do";

		String userId = loginUser.getUserId();
		if (postService.hasAlreadyRecommendedComment(userId, commentId)) {
			response.setContentType("text/html; charset=UTF-8");
			response.getWriter().write("<script>alert('Ïù¥ÎØ∏ Ï∂îÏ≤úÌïòÏÖ®ÏäµÎãàÎã§.'); history.back();</script>");
			return null;
		}
		postService.recommendComment(commentId, userId);
		return "redirect:/postDetail.do?postId=" + postId;
	}

	// ÎåìÍ∏Ä Ïã†Í≥† (Ï§ëÎ≥µ Î∞©ÏßÄ)
	@PostMapping("/reportComment.do")
	public String reportComment(@RequestParam("commentId") Long commentId, @RequestParam("postId") Long postId,
			HttpSession session, HttpServletResponse response) throws IOException {
		User loginUser = (User) session.getAttribute("loginUser");
		if (loginUser == null)
			return "redirect:/loginPage.do";

		String userId = loginUser.getUserId();
		if (postService.hasAlreadyReportedComment(userId, commentId)) {
			response.setContentType("text/html; charset=UTF-8");
			response.getWriter().write("<script>alert('Ïù¥ÎØ∏ Ïã†Í≥†ÌïòÏÖ®ÏäµÎãàÎã§.'); history.back();</script>");
			return null;
		}
		postService.reportComment(commentId, userId);
		return "redirect:/postDetail.do?postId=" + postId;
	}

	// ÎåìÍ∏Ä ÏÇ≠Ï†ú
	@PostMapping("/deleteComment.do")
	public String deleteComment(@RequestParam("commentId") Long commentId, @RequestParam("postId") Long postId) {
		postService.deleteComment(commentId);
		return "redirect:/postDetail.do?postId=" + postId;
	}

	// Í≤åÏãúÍ∏Ä ÏàòÏ†ï
	@PostMapping("/updatePost.do")
	public String updatePost(@ModelAttribute PostDTO post,
	                         @RequestParam(value = "uploadFile", required = false) MultipartFile file,
	                         @RequestParam(value = "deleteFile", required = false) String deleteFile,
	                         HttpSession session) throws IOException {

	    // Í∏∞Ï°¥ ÌååÏùº Í≤ΩÎ°ú
	    String uploadDir = session.getServletContext().getRealPath("/resources/uploads/");
	    File oldFile = null;

	    if ("true".equals(deleteFile)) {
	        // Í∏∞Ï°¥ ÌååÏùº ÏÇ≠Ï†ú
	        if (post.getPostSavedName() != null) {
	            oldFile = new File(uploadDir, post.getPostSavedName());
	            if (oldFile.exists()) oldFile.delete();
	        }
	        // DTOÏóêÏÑú ÌååÏùºÏ†ïÎ≥¥ Ï†úÍ±∞
	        post.setPostOriginalName(null);
	        post.setPostSavedName(null);
	    }

	    if (file != null && !file.isEmpty()) {
	        // Í∏∞Ï°¥ ÌååÏùºÏù¥ ÏûàÏúºÎ©¥ ÏÇ≠Ï†ú
	        if (post.getPostSavedName() != null) {
	            oldFile = new File(uploadDir, post.getPostSavedName());
	            if (oldFile.exists()) oldFile.delete();
	        }

	        // ÏÉà ÌååÏùº Ï†ÄÏû•
	        String originalName = file.getOriginalFilename();
	        String savedName = UUID.randomUUID() + "_" + originalName;
	        File saveFile = new File(uploadDir, savedName);

	        // ÎîîÎ†âÌÜ†Î¶¨ ÏóÜÏúºÎ©¥ ÏÉùÏÑ±
	        if (!saveFile.getParentFile().exists()) {
	            saveFile.getParentFile().mkdirs();
	        }

	        file.transferTo(saveFile);

	        post.setPostOriginalName(originalName);
	        post.setPostSavedName(savedName);
	    }

	    postService.updatePost(post);

	    return "redirect:postDetail.do?postId=" + post.getPostId();
	}

	// Í≤åÏãúÍ∏Ä ÏàòÏ†ï ÌôîÎ©¥
	@GetMapping("/editPost.do")
	public String editPostForm(@RequestParam("postId") Long postId, Model model) {
		PostDTO post = postService.getPostById(postId);
		model.addAttribute("post", post);
		return "board/editPost";
	}

	@PostMapping("/deletePost.do")
	public String deletePost(@RequestParam("postId") Long postId, HttpSession session) {
	    PostDTO post = postService.getPostById(postId);

	    // Ï≤®Î∂Ä ÌååÏùºÏù¥ ÏûàÎäî Í≤ΩÏö∞ Ïã§Ï†ú ÌååÏùºÎèÑ ÏÇ≠Ï†ú
	    if (post.getPostSavedName() != null) {
	        String uploadPath = session.getServletContext().getRealPath("/resources/uploads/");
	        File fileToDelete = new File(uploadPath, post.getPostSavedName());
	        if (fileToDelete.exists()) fileToDelete.delete();
	    }

	    postService.deletePostAndDependencies(postId);
	    return "redirect:/freeBoard.do";
	}
	
	// Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìúÏö©
	@PostMapping("/uploadImage.do")
	@ResponseBody
	public String uploadImage(@RequestParam("image") MultipartFile file, HttpServletRequest request) throws IOException {
	    String uploadDir = request.getServletContext().getRealPath("/resources/uploads/");
	    File dir = new File(uploadDir);
	    if (!dir.exists()) dir.mkdirs();

	    String originalFilename = file.getOriginalFilename();
	    String ext = originalFilename.substring(originalFilename.lastIndexOf("."));
	    String savedName = UUID.randomUUID() + ext;

	    File dest = new File(uploadDir, savedName);
	    file.transferTo(dest);

	    // ‚úÖ Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú Ï†ëÍ∑º Í∞ÄÎä•Ìïú URLÎ°ú Î¶¨ÌÑ¥Ìï¥Ïïº Ïù¥ÎØ∏ÏßÄÍ∞Ä Î≥¥ÏûÑ!
	    return request.getContextPath() + "/resources/uploads/" + savedName;
	}
	
	private String extractFirstImageUrl(String html) {
	    if (html == null) return null;
	    Pattern pattern = Pattern.compile("<img[^>]+src=[\"']?([^\"'>]+)[\"']?");
	    Matcher matcher = pattern.matcher(html);
	    return matcher.find() ? matcher.group(1) : null;
	}
	
	// Ïù¥ÎØ∏ÏßÄ ÌôïÏû•Ïûê ÌôïÏù∏
	private boolean isImageFile(String filename) {
	    return filename != null && filename.toLowerCase().matches(".*\\.(jpg|jpeg|png|gif)$");
	}
	
	

	// ‚úÖ Ïã†Í≥†Îêú Í≤åÏãúÍ∏Ä Î™©Î°ù
	@GetMapping("/reportedPosts.do")
	public String showReportedPosts(HttpSession session, Model model,
			@RequestParam(value = "page", required = false, defaultValue = "1") int page) {
		User loginUser = (User) session.getAttribute("loginUser");
		if (loginUser == null || !"2".equals(loginUser.getUserAuthority())) {
			return "redirect:/loginPage.do";
		}

		int pageSize = 10;
		int offset = (page - 1) * pageSize;

		model.addAttribute("reportedPostList", postService.getReportedPosts(offset, pageSize));
		model.addAttribute("currentPage", page);
		model.addAttribute("totalPages", (int) Math.ceil((double) postService.countReportedPosts() / pageSize));
		return "board/reportedPosts";
	}

	// ‚úÖ Í≤åÏãúÍ∏Ä Îã§Ï§ë ÏÇ≠Ï†ú + Ïã†Í≥†Í∏∞Î°ù ÏÇ≠Ï†ú
	@PostMapping("/deleteSelectedPosts.do")
	public String deleteSelectedPosts(@RequestParam("selectedPosts") List<Long> postIds) {
		postService.deletePostsAndReports(postIds); // üîÑ Í≤åÏãúÍ∏ÄÍ≥º Ïó∞Í≤∞Îêú Ïã†Í≥† Í∏∞Î°ù Î®ºÏ†Ä ÏÇ≠Ï†ú ÌõÑ Í≤åÏãúÍ∏Ä ÏÇ≠Ï†ú
		return "redirect:/reportedPosts.do";
	}

	// ‚úÖ Ïã†Í≥†Îêú ÎåìÍ∏Ä Î™©Î°ù
	@GetMapping("/reportedComments.do")
	public String showReportedComments(HttpSession session, Model model,
			@RequestParam(value = "page", required = false, defaultValue = "1") int page) {
		User loginUser = (User) session.getAttribute("loginUser");
		if (loginUser == null || !"2".equals(loginUser.getUserAuthority())) {
			return "redirect:/loginPage.do";
		}

		int pageSize = 10;
		int offset = (page - 1) * pageSize;

		model.addAttribute("reportedCommentList", postService.getReportedComments(offset, pageSize));
		model.addAttribute("currentPage", page);
		model.addAttribute("totalPages", (int) Math.ceil((double) postService.countReportedComments() / pageSize));
		return "board/reportedComments";
	}

	// ‚úÖ Ïã†Í≥† ÎåìÍ∏Ä ÏÇ≠Ï†ú
	@PostMapping("/deleteSelectedComments.do")
	public String deleteSelectedComments(@RequestParam("selectedComments") List<Long> commentIds) {
		postService.deleteReportedCommentsByIds(commentIds);
		return "redirect:/reportedComments.do";
	}

	// ‚úÖ Î∂àÎüâ Ïù¥Ïö©Ïûê Î™©Î°ù
	@GetMapping("/badUserList.do")
	public String showBadUserList(Model model) {
		List<Map<String, Object>> badUserList = postService.getBadUsers();
		model.addAttribute("badUserList", badUserList);
		return "board/badUserList";
	}

	// Î∂àÎüâ Ïù¥Ïö©Ïûê Îì±Î°ù
	@PostMapping("/registerBadUsers.do")
	public void registerBadUsers(@RequestParam("selectedPosts") List<Long> postIds,
			@RequestParam("reason") String reason, HttpSession session, HttpServletResponse response)
			throws IOException {
		User loginUser = (User) session.getAttribute("loginUser");

		try {
			postService.registerBadUsersFromPosts(postIds, reason, loginUser.getUserId());
			response.sendRedirect("reportedPosts.do");
		} catch (IllegalStateException e) {
			response.setContentType("text/plain; charset=UTF-8");
			response.setStatus(400); // Ïã§Ìå®Î°ú Ïù∏ÏãùÎêòÎèÑÎ°ù ÏÉÅÌÉúÏΩîÎìú ÏÑ§Ï†ï
			response.getWriter().write(e.getMessage());
		}
	}

	// ‚úÖ ÎåìÍ∏Ä ÏûëÏÑ±Ïûê Î∂àÎüâ Îì±Î°ù
	@PostMapping("/registerBadUsersFromComments.do")
	public void registerBadUsersFromComments(@RequestParam("selectedComments") List<Long> commentIds,
			@RequestParam("reason") String reason, HttpSession session, HttpServletResponse response)
			throws IOException {
		User loginUser = (User) session.getAttribute("loginUser");

		try {
			postService.registerBadUsersFromComments(commentIds, reason, loginUser.getUserId());
			response.sendRedirect("reportedComments.do");
		} catch (IllegalStateException e) {
			response.setContentType("text/plain; charset=UTF-8");
			response.setStatus(400); // Ïã§Ìå®Î°ú Ïù∏ÏãùÎêòÎèÑÎ°ù ÏÉÅÌÉúÏΩîÎìú ÏÑ§Ï†ï
			response.getWriter().write(e.getMessage());
		}
	}

	@PostMapping("/restoreBadUsers.do")
	public String restoreBadUsers(@RequestParam("selectedUsers") List<String> userIds) {
		postService.updateUserAuthority(userIds, 1); // ÏùºÎ∞ò Ïú†Ï†ÄÎ°ú Î≥ÄÍ≤Ω
		return "redirect:badUserList.do";
	}

	// Ïú†Ï†Ä ÌÉàÌá¥ÏãúÌÇ§Í∏∞
	@PostMapping("/withdrawBadUsers.do")
	public String withdrawBadUsers(@RequestParam("selectedUsers") List<String> userIds, HttpServletResponse response) throws IOException {
	    // Í¥ÄÎ¶¨Ïûê Ïú†Ï†Ä Ï†úÏô∏ (userAuthority == 2 Ïù∏ Ïú†Ï†Ä Ï†úÏô∏)
	    List<String> filtered = userIds.stream()
	        .filter(id -> {
	            int authority = postService.getUserAuthority(id); // ÏÉàÎ°ú ÎßåÎì† Î©îÏÑúÎìúÎ°ú Í∂åÌïú Ï°∞Ìöå
	            return authority != 2;
	        })
	        .toList();

	    if (filtered.isEmpty()) {
	        response.setContentType("text/html; charset=UTF-8");
	        response.getWriter().write("<script>alert('Í¥ÄÎ¶¨ÏûêÎäî ÌÉàÌá¥ÏãúÌÇ¨ Ïàò ÏóÜÏäµÎãàÎã§.'); history.back();</script>");
	        return null;
	    }

	    postService.updateUserAuthority(filtered, 4); // Í∂åÌïú 4 = ÌÉàÌá¥
	    return "redirect:/badUserList.do";
	}
	
	//Î™∞ÎûòÌïòÎäî ÏõîÎìúÏªµ
	@RequestMapping("worldCup.do")
	public String worldCupPage(Model model) throws Exception {
	    List<Job> jobList = postService.getAllJobs();
	    ObjectMapper mapper = new ObjectMapper(); // Jackson ÏÇ¨Ïö©
	    String jobListJson = mapper.writeValueAsString(jobList); // JSON Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò
	    model.addAttribute("jobListJson", jobListJson);
	    return "worldCup";
	}

}
